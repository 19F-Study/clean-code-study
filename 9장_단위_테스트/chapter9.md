# 단위 테스트

> 우리는 테스트 코드의 필요성에 대해서 인지하고 있지만, 테스트를 추가하려고 급하게 서두르는 와중에 제대로 된 테스트 케이스를 작성해야 한다는 사실을 놓쳐버렸다. ( p155 )

<br>

## TDD (Test-Driven Development)

![img](https://s3.amazonaws.com/ckl-website-static/wp-content/uploads/2017/03/TDD-e1492712699769-300x300.png)

> 테스트 주도 개발(Test-driven development TDD)은 애자일 소프트웨어 개발 방법론중의 하나로서, 빠른 피드백 및 협력에 도움을 주는 대표적인 개발 방법론이며, 매우 짧은 개발 사이클을 반복하는게 특징이다.

> 개발자는 초기적 결함을 점검할 수 있는 테스트 케이스를 작성한다. 그런 후에, 그 케이스를 통과하기 위한 최소한의 양의 코드를 생성한다. 그리고 마지막으로 그 새 코드를 표준에 맞도록 (즉, 행동은 변하지 않는 선에서 ) 리팩토링한다. - [wiki page](https://ko.wikipedia.org/wiki/%ED%85%8C%EC%8A%A4%ED%8A%B8_%EC%A3%BC%EB%8F%84_%EA%B0%9C%EB%B0%9C)

<br>

TDD 법칙 세 가지
1. 실패하는 단위 테스트를 작성할 때까지 실제 코드를 작성하지 않는다.
2. 컴파일은 실패하지 않으면서 실행이 실패하는 정도로만 단위 테스트를 작성한다.
3. 현재 실패하는 테스트를 통과할 정도로만 실제 코드를 작성한다.

<br>

## 깨끗한 테스트 코드

**왜 깨끗한 테스트 코드를 만들어야 할까?**
- 테스트 코드가 지저분할수록 변경이 어려워지고, 실제 코드를 짜는 시간보다 테스트를 추가하는 시간이 더 걸릴 수 있다.
- 잘 짜여진 테스트 코드가 있으면 별다른 우려 없이 코드를 변경할 수 있다. 다시 말해서, 테스트는 코드의 변경을 쉽게 하며, 이는 코드의 유연성, 유지보수성, 그리고 재사용성을 제공한다.
  - 반대로, 테스트 코드가 지저분하면 코드를 변경하는 능력이 떨어지며, 코드 구조를 개선하는 능력도 떨어진다.

<br>

**어떻게 깨끗한 테스트 코드를 만들까?**
- 가독성이 좋은 테스트 코드를 만들면 깨끗한 테스트 코드를 작성할 수 있다.
  - BUILD–OPERATE–CHECK Pattern
    - 각 테스트는 명확하게 세 부분으로 나누어질 수 있다는 아이디어에 의해 만들어진 패턴.
    - BUILD: 테스트 자료 생성.
    - OPERATE: 테스트 자료 조작.
    - CHECK: 조작한 결과가 올바른지 확인.
  - 도메인에 특화된 테스트 언어
    - 실제 사용되는 API 대신, 그 API 위에다 함수와 유틸리티를 구현한 후 그 함수와 유틸리티를 사용하는 방식.
    - 테스트 코드를 짜기도 읽기도 쉬워짐.
    - 이렇게 구현한 함수와 유틸리티는 테스트 코드에서 사용하는 특수한 API가 됨.
  - 이중 표준
    - 실제 운영 환경에서 프로그램을 원활히 실행하기 위해 따라야 하는 표준 (CPU Usage, Memory)을 테스트 코드에서는 굳이 따르지 않아도 된다는 의미
    - e.g) 테스트 환경에서 String append를 할 경우, String이든 StringBuffer이든 상관없이 가독성을 높여주는 코드를 선택하면 됨.

<br>

## 테스트 당 assert 하나 / 개념 하나
- 단일 assert: 코드를 이해하기 쉽고 빠르기 때문에, 저자는 대체로 단일 assert를 지원하는 테스트를 구현하려고 노력한다.
- 단일 개념: 하나의 메서드는 한 가지 역할에만 충실해야 하듯이, 하나의 테스트 또한 한 가지만을 테스트 하는데에 충실해야 한다.
- *개념 당 assert문 수를 최소로 줄이고, 테스트 함수 하나는 개념 하나만 테스트하라*

<br>

## First
깨끗한 테스트는 다음 다섯 가지 규칙을 따른다.
- Fast: 테스트는 빨라야 한다.
- Independent: 각 테스트는 서로 의존하면 안된다.
- Repeatable: 테스트는 어떤 환경에서도 반복 가능해야 한다.
- Self-Validating: 테스트는 성공 아니면 실패로만 결과를 반환하는 등 자신이 주체적으로 검증해야 한다.
- Timely: 단위 테스트는 테스트하려는 실제 코드를 구현하기 직전에 구현해야 한다. 그렇지 않으면 테스트가 불가능하도록 실제 코드를 설계할지도 모른다.

<br>

ref
- TDD, https://ko.wikipedia.org/wiki/%ED%85%8C%EC%8A%A4%ED%8A%B8_%EC%A3%BC%EB%8F%84_%EA%B0%9C%EB%B0%9C
- BUILD-OPERATE-CHECK Pattern, https://www.codingblocks.net/podcast/how-to-write-amazing-unit-tests/
- image, https://s3.amazonaws.com/ckl-website-static/wp-content/uploads/2017/03/TDD-e1492712699769-300x300.png
- 